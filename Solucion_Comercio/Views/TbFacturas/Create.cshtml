@model Solucion_Comercio.Models.TbFactura

@{
    ViewData["Title"] = "Crear";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*<h1>Crear nueva Venta</h1>

<h4>Facturas</h4>*@
<hr />

<div class="card">
  <div class="card-header">
      Factura
  </div>
    <div class="row align-items-end">
        <div class="col-sm-6">
            <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Buscar Producto</label>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="txtBuscar">
                    <span class="input-group-text" id="basic-addon1"><i class="fas fa-search"></i></span>
                </div>
            </div>
        </div>
        @*<div class="col-sm-6 d-flex justify-content-end">
            <button id="btnPagar" class="btn btn-success btn-lg mr-3 mb-3 m-3" style="padding: 20px;">Pagar</button>
        </div>*@
    </div>

        <div class="row">
            <div class="col-sm-12">
                <table class="table table-bordered" id="tbproductos">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">Producto</th>
                            <th scope="col">Precio</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </div>
        </div>







    <div class="mb-2 col-sm-3">
        <label class="form-label">Total</label>
       
        <input  class="form-control" id="TotalPagar" readonly>
    </div>

    <div class="mb-2 col-sm-3">
        <label class="form-label">Tarjeta</label>
        <input class="form-control" id="tarjeta">
    </div>

    <div class="mb-2 col-sm-3">
        <label class="form-label">Efectivo</label>
        <input class="form-control" id="efectivo">
    </div>

    <br />

    <div class="col-sm-3 mr-3 d-flex ">
        <button id="btnCalcularCambio" class="btn btn-primary">Calcular Cambio</button>
        <div id="resultadoCambio" class="mt-3"></div>
        
        
      
    </div>
    <div class=" mb- 2 col-sm-3  d-flex ">
        <label class="form-label mr-3 mt-3">Cambio</label>
        <input class="form-control ml-3 mt-3" id="Cambio" readonly>

    </div>
   
    

    <button id="realizarpago" class="btn btn-success mr-3 mb-3 m-3 " style="padding: 20px ">Efectuar pago</button>
    <div id="realizarPago" class="mt-3"></div>


  </div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@*//este fue un comentario agregado*@

@section Scripts {

    <script>
        $(document).ready(function () {
            $("#txtBuscar").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("BusquedaControl", "Home")?busqueda=' + request.term,
                        data: { busqueda: request.term },
                        dataType: "json",
                        success: function (data) {
                            response(data);
                        }
                    });
                },
                select: function (event, elemento) {
                    console.log(elemento)

                    $("#tbproductos tbody").append(
                        $("<tr>").append(
                            $("<td>").text(elemento.item.nombreProducto),
                            $("<td>").text(elemento.item.precioProducto),
                            $("<td>").text(1),
                            $("<td>").text(elemento.item.precioProducto * 1),
                        )
                    );

                    // Limpiar el valor del textbox después de seleccionar un producto
                    event.preventDefault();
                    $(this).val("");

                    // Calcular el total del precio de los productos en la tabla
                    calcularTotalPrecioProductos();
                }
            });


            function calcularTotalPrecioProductos() {
                var total = 0;
                $("#tbproductos tbody tr").each(function () {
                    var precio = parseFloat($(this).find("td:eq(3)").text());
                    total += isNaN(precio) ? 0 : precio;
                });

                // Mostrar el total en el campo de entrada
                $("#TotalPagar").val(total.toFixed(2)); // Puedes usar toFixed para mostrar solo 2 decimales
            }

            // Agrega un evento al botón para calcular el cambio
            $("#btnCalcularCambio").click(function () {
                calcularCambio();
            });

            function calcularCambio() {
                
                var total = parseFloat($("#TotalPagar").val()); // Obtener el total a pagar
                var montoEfectivo = parseFloat($("#montoPagado").val()); // Obtener el monto pagado
                var montoTarjeta


                if (!isNaN(montoEfectivo) && !isNaN(total)) {
                    var cambio = montoEfectivo - total;
                    $("#Cambio").val(cambio.toFixed(2)); // Mostrar el cambio en el campo de entrada
                } else {
                    $("#Cambio").val("N/A"); // Mostrar "N/A" si los valores no son válidos
                }
            }


        });

    </script>


}

